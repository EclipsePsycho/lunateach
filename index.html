<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LunaTeach Marketplace</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
      padding: 20px; 
      margin: 0; 
      background: var(--tg-theme-bg-color); 
      color: var(--tg-theme-text-color); 
    }
    h1 { text-align: center; color: var(--tg-theme-link-color); margin-bottom: 30px; }
    .card { 
      background: var(--tg-theme-secondary-bg-color); 
      border-radius: 16px; 
      padding: 20px; 
      margin: 16px 0; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
    }
    .name { font-size: 1.5em; font-weight: bold; margin-bottom: 8px; }
    .detail { margin: 10px 0; color: var(--tg-theme-hint-color); line-height: 1.4; }
    .bio { font-style: italic; }
    .connect-btn { 
      background: var(--tg-theme-button-color); 
      color: var(--tg-theme-button-text-color); 
      border: none; 
      padding: 14px; 
      width: 100%; 
      border-radius: 12px; 
      font-size: 1.2em; 
      font-weight: bold;
      margin-top: 16px;
      cursor: pointer;
    }
    .user-info { 
      text-align: center; 
      margin: 20px 0; 
      padding: 12px;
      background: var(--tg-theme-secondary-bg-color);
      border-radius: 12px;
      font-size: 1em;
      color: var(--tg-theme-hint-color);
    }
  </style>
</head>
<body>
  <div class="user-info" id="user-info">Loading...</div>
  <h1>üîç Find Your Teacher</h1>
  <div id="teachers-list"></div>

  <script>
    // Initialize Telegram Mini App
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // Show user info
    const user = Telegram.WebApp.initDataUnsafe.user;
    const userInfo = document.getElementById('user-info');
    if (user) {
      userInfo.innerText = `Welcome back, ${user.first_name || 'Student'}! üëã`;
    } else {
      userInfo.innerText = 'Welcome to LunaTeach Marketplace!';
    }

    // Sample teachers (replace later with real data)
    const teachers = [
      {
        id: "123456789",
        name: "Alex Rivera",
        subjects: ["Speaking", "IELTS"],
        availability: "Evening",
        bio: "8+ years helping students hit Band 7+ in IELTS. Native speaker from UK."
      },
      {
        id: "987654321",
        name: "Maria Chen",
        subjects: ["Writing", "Speaking"],
        availability: "Morning & Afternoon",
        bio: "Certified teacher specializing in essay structure and fluent conversation."
      },
      {
        id: "555555555",
        name: "John Kim",
        subjects: ["IELTS", "Writing"],
        availability: "Evening",
        bio: "Former IELTS examiner. I know exactly what they look for!"
      }
    ];

    // Render teacher cards
    const list = document.getElementById('teachers-list');
    teachers.forEach(teacher => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="name">üßë‚Äçüè´ ${teacher.name}</div>
        <div class="detail"><strong>Subjects:</strong> ${teacher.subjects.join(', ')}</div>
        <div class="detail"><strong>Available:</strong> ${teacher.availability}</div>
        <div class="detail bio">${teacher.bio}</div>
        <button class="connect-btn" data-tid="${teacher.id}">ü§ù Connect Now</button>
      `;
      list.appendChild(card);
    });

    // Handle Connect buttons
    document.querySelectorAll('.connect-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tid = btn.dataset.tid;
        const payload = JSON.stringify({
          action: "connect",
          teacher_id: tid,
          student_name: user ? (user.first_name + (user.last_name ? ' ' + user.last_name : '')) : "Student"
        });
        
        Telegram.WebApp.sendData(payload);
        
        // Feedback
        btn.innerText = "‚úÖ Request Sent!";
        btn.disabled = true;
        btn.style.opacity = "0.7";
      });
    });
  </script>
</body>
</html>
